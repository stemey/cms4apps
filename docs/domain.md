domain
======

The domain model consists of entities, types and stores. Sometimes types are also called templates or schemas.

An entity is usually a json document which is accessed via a store. A store provides access to entities via http or it serves them from a browser storage.
Stores are an extension of `dojo/store`. They provide access to the entities types. All entities have a type. The type is usually a gform schema. It may
be a different schema or type but it must be converted to gform schema to be useful.

store.getDefault()
store.template or store.templateStore and store.typeProperty
store.idProperty
store.editorFactory

## schema

A schema defines the attributes (properties) a json document may have. These schemas are usually gform schema documents that are perfect to create
a form to edit its instances.

## meta schema

Statically typed databases like SQL-Db can provide schemas for its data
so that they can be edited. Schemafree databases like MongoDb either have informal schemas or schemas are defined in client side libraries like Morphia, Spring-data or Mongoose.
Often enough there is no schema at all. In these cases schemas can be defined in a gform client and stored in the database or elsewhere. The
 main purpose of that schema is to make it easy to edit the content of the database. To create an editor to edit schemas you need the schemas' meta schema.
 This is usually generated by SchemaGenerators.

In that case a schema is an entity which resides in a store whose schema is the meta schema.

## entity

an entity has a property that contains a unique id. This id needs to be unique across a store. Entities that are contained in a multi-type store
also have a type property. The typeProperty and th idProperty are provided by the store.


To retrieve an entity's type there are two ways:

1. All entities in the store have the same type.
`store.template`is the id of the schema. To retrieve it use `schemaRegistry.get(id)`.

2. The store contains entities of different types.

An entities type is defined by its typeProperty. The name of the typeProperty is retrieved from `store.typeProperty`.
To retrieve the the schema from the schemaRegistry you need to prefix the typeProperty's value with `store.templateStore`.

    var schema = schemaRegistry.get(store.templateStore+"/"+entity[store.typeProperty];
    // equivalent to
    var schema = storeRegistry.get(store.templateStore).get(entity[store.typeProperty])



## StoreFactory

To configure a store a StoreFactory is used.

    {
        "factoryId": "cms/factory/StoreFactory",
        "storeClass": "cms/util/JsonRest", // the type of the Store
        "name": "/page",  // the id (name) of the store
        "templateStore": "/template", // the id of its templates' stores
        "instanceStore": "/page", // if the  entities in this store are templates, then instanceStore is the id of the store that contains the instances. Not present if templateStore is present.
        "idProperty": "identifier", // the id property
        "idType": "string", // the type of the id property, used to create the schema
        "typeProperty": "template", // the type property
        "target": "http://localhost:8080/entity/base/", // the base url
        "createEditorFactory": "cms/createBuilderEditorFactory", // the factory function of the EditorFactory. To create the editor for the entities
        "plainValueFactory": "cms/default/createTemplateValueFactory" // the function that creates default instances
    }


## SchemaRegistry

All type, schemas and templates are accessible through the SchemaRegistry.


    {
        "factoryId": "cms/factory/schema/SchemaRegistryFactory",
        "registryClass": "cms/SchemaRegistry",
        "stores": ["/template"], // stores that contains schemas
        "schemaGenerators": [
            {
                "factoryId": "cms/factory/schema/SchemaGenerator",
                "store": "/template"
            }
        ]
    }

Schemas are store or simply read from stores. Some Schema are generated by SchemaGenerators. These are usually meta schema, whose instances are schemas themselves and are stored in a store.

